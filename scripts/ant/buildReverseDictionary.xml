<?xml version="1.0" encoding="windows-1251"?>

 <project name="ReverseDictionary project build script" basedir="../research/ant" default="javadoc">
    
  <splash />

  <!-- Свойства данного проекта -->
  <property name="project.name"            value="ReverseDictionary"/>
  <property name="javadoc.title"           value="Тестовое приложение ReverseDictionary"/>
  <property name="javadoc.copyright.gusev" value="Copyright &#169; 2011 Gusev Dmitry"/>
  <!-- Эти свойства в проектах вынесены в глобальный файл свойств -->
  <property name="src.dir"        value="src"/>
  <property name="libs.dir"       value="libs"/>
  <property name="docs.dir"       value="docs"/>
  <property name="build.dir"      value="build"/>
  <property name="production.dir" value="production"/>
  <property name="test.class.name" value="dmitry.gusev.ReverseDictionaryTest" />

  <!-- Список используемых библиотек. Эти библиотеки находятся в локальном каталоге libs. -->
  <fileset id="project_libraries" dir="${libs.dir}" includes="**/*.jar" casesensitive="false" />

  <!-- Инициализация перед сборкой - создание необходимых каталогов, очистка каталогов, копирование ресурсов. -->
  <target name="init">
   <!-- Создание необходимых каталогов (если их еще нет) -->
   <mkdir dir="${build.dir}"/>
   <mkdir dir="${production.dir}"/>
   <!-- Очистка необходимых каталогов (от остатков предыдущей сборки) -->
   <delete includeemptydirs="true" failonerror="false"><fileset dir="${build.dir}" includes="**/*"/></delete>
   <delete includeemptydirs="true" failonerror="false"><fileset dir="${production.dir}" includes="**/*"/></delete>
   <!-- Копируем необходимые либы в продакшен каталог -->
   <copy todir="${production.dir}/${libs.dir}">
    <fileset dir="${libs.dir}"><include name="**/*.jar"/></fileset>
   </copy>
  </target>

  <!-- Компиляция исходного кода. Задача зависит от задачи "init". -->
  <target name="build" depends="init">
   <javac srcdir="${src.dir}" destdir="${build.dir}" debug="on" source="1.6" target="1.6" includeantruntime="no">
    <classpath><fileset refid="project_libraries"/></classpath>
   </javac>
   <!-- Делаем файл с номером билда -->
   <buildnumber file="${project.name}.build.number"/>
  </target>

  <!-- Запуск тестов JUnit -->
  <target name="junit_test" depends="build">
   <junit dir="${build.dir}" printsummary="yes" fork="yes" haltonfailure="yes">
    <classpath>
     <pathelement location="${build.dir}"/>
     <pathelement location="${libs.dir}/junit-4.8.2.jar"/>
    </classpath>
    <test name="${test.class.name}"/>
   </junit>
  </target>

  <!-- Сборка JAR. Задача зависит от задачи "build". -->
  <target name="jar" depends="junit_test">
   <!-- Из набора используемых библиотек формируем свойство CLASSPATH  для включения в файл манифеста. -->
   <manifestclasspath property="jar_classpath" jarfile="${production.dir}/${project.name}.jar">
    <classpath><fileset dir="${production.dir}/${libs.dir}"><include name="**/*.jar"/></fileset></classpath>
   </manifestclasspath>
   <!-- Непосредственно сборка JAR -->
   <jar destfile="${production.dir}/${project.name}.jar" basedir="${build.dir}">
    <exclude name="**/*Test*"/>
    <manifest>
     <attribute name="Built-By" value="Gusev Dmitry"/>
     <attribute name="Main-Class" value="dmitry.gusev.ReverseDictionary"/>
     <attribute name="Class-Path" value="${jar_classpath}"/>
    </manifest>
   </jar>
  </target>

  <!-- Сборка документации по проекту - данная задача зависит от задачи "jar". -->
  <target name="javadoc" depends="jar">
   <!-- Задача ANT - JAVADOC -->
   <javadoc destdir="${production.dir}/${docs.dir}" author="true" version="true" use="true" windowtitle="API for [${project.name}]."
    access="public" splitindex="true">
    <classpath><fileset refid="project_libraries"/></classpath>
    <fileset dir="${src.dir}" defaultexcludes="yes"><include name="**/*.java"/></fileset>
    <doctitle><![CDATA[<h1>${javadoc.title}</h1>]]></doctitle>
    <bottom><![CDATA[<i>${javadoc.copyright.gusev}</i>]]></bottom>
   </javadoc>
  </target>

 </project>