<html>
<body>
 Система почтовой рассылки MassEmailsSender, версия 3.2.1 (04.04.2011). Система осуществляет почтовую рассылку по списку
 email-адресов из БД Флот-Фирмы или по тестовому списку адресов - адреса отдела 019. Система может использоваться как
 отдельная утилита (консольная), так и в качестве библиотеки - все классы системы открыты для внешнего использования.
 Подробнее о работе и об использовании системы - см. ниже в документации и javadoc данного модуля.

<p><b>Зависимости.</b></p>
 <p>Для использования данной системы (для работы с ее текущей версией) необходимы следующие библиотеки
    (зависимости от внешних библиотек):
 <ul>
  <li>log4j (1.2.15)              - модуль ведения журнала работы/ошибок (логгирование).
  <li>commons-loggigng (1.1)      - общий интерфейс логгирования для библиотек commons.
  <li>commons-lang (2.4)          - модуль, содержащий большой набор общеупотребительных утилитарных функций.
  <li>commons-configuration (1.6) - работа с конфигурационными xml-файлами
  <li>commons-cli (1.2)           - модуль для работы с командной строкой (cli - command line interface).
  <li>javamail (1.4.3+)           - модуль для работы с электронной почтой.
  <li>commons-collections (3.2)   - общие коллекции, используется различными модулями commons.
  <li>jtds (1.2.5+)               - драйвер для соединения с СУБД MS SQL Server 2005.
  <li>dbf_jdbc30_ok (3.0)         - драйвер для работы с DBF базами данных.
  <li>jdb (9.0.0 BETA+)           - прикладная библиотека для работы с СУБД.
  <li>jlib (4.6.0+)               - прикладная библиотека, содержащая различные утилиты.
 </ul>

<p><b>Использование логгирования.</b></p>
 <p>
  Для работы системы логгирования следует инициализировать логгер с именем "spammer" - тогда все классы библиотеки смогут вести
  журналирование. Если же логгер инициализирован не будет, то при работе библиотеки будет возникать сообщение об этом (WARNING).
  Также следует инициализировать логгеры с именами org, jlib, jdb для того, чтобы используемые библиотеки jdb, jlib, commons тоже могли
  вести журналирование.

<p><b>Соединение с СУБД MS SQL 2005</b></p>
 <p>
  Для соединения с указанной СУБД используется конфигурационный файл spammer.xml, который должен находиться в каталоге
  с утилитой. При использовании системы в качестве бибилиотеки - читай javadoc к компонентам DAO для правильного
  конфигурирования.

<p><b>Особенности системы</b></p>
 <p>
 <br> 1) Основной принцип работы данной системы с БД: все идентификаторы во всех таблицах являются целыми положительными
         числами (строго БОЛЬШЕ 0). При нарушении данного принципа система окажется неработоспособна.
 <br> 2) Формирование путей к файлам рассылки. Путь формируется следующим образом:
         [путь к общему каталогу с файлами] + [идентификатор рассылки из БД] + [имя файла], т.е. все файлы одной рассылки
         хранятся в каталоге с ее идентификатором. Об этом стоит помнить при сохранении файлов, прикрепленных к рассылкам.
         [путь к общему каталогу с файлами] - именно этот путь (с конечным символом \) указывается параметром командной строки
         -deliveriesFiles (см. ниже описание).
 <br> 3) Выбор источника для построения списка e-mail адресов осуществляется по данным БД Рассылок (см. скрипт БД). Обязательно
         указывать не менее одного типа получателей рассылки - тогда рассылка произойдет. Если же для рассылки не будет указан
         ни один тип получателей - рассылка не будет выполнена. Тип получателей рассылки указзывается в таблице recipientsType
         БД Рассылок.
 <br> 4) Для хранения списка e-mail адресов используется java-коллекция TreeMap&lt;String, Integer&gt; (строка - емайл-адрес,
         целое число - идентификатор компании), что гарантирует уникальность ключа (String - непосредственно сам e-mail адрес), т.о.
         список будет содержать набор уникальных строковых значений. Но. Если майлы в одном из значений указаны таким образом:
         "email1, email2, email3", то при появлении любого из адресов email1 или email2 или email3 в отдельном поле уникальность
         будет нарушена. Это важно помнить.
 <br> 5) Начиная с версии 3.2.0 в системе появилась новая таблица (mandatoryEmails - см. скрипт создания БД системы) и новое
         свойство - при ЛЮБОЙ майл-рассылке адреса из таблицы mandatoryEmails добавляются в рассылку, даже в демо-режиме рассылки.
         Из указанной таблицы добавляются только майл-адреса имеющие статус "активный" (поле deleted = 0). Адреса из указанной таблицы
         НЕ добавляются при тестовой рассылке на определенный адрес (параметр командной строки -testMailTo см. ниже)
 
<p><b>Работа с БД РАССЫЛКА (MssEmailsSender)</b></p>
 <p>
 Для того, чтобы система смогла осуществить рассылку, необходимо в БД Рассылок (СУБД MS SQL 2005, БД MassEmailsSender)
 подготовить данные:
 <br>1) В таблице DELIVERIES заполнить поля subject, text, type, initiator.
 <br>2) В таблице DELIVERIESFILES указать прикрепленные к данной рассылке файлы - поля fileName и deliveryId.
 <br>3) Полученный при создании записи в таблице DELIVERIES идентификатор рассылки указать в параметре deliveryId данной
        утилиты при ее запуске.

<p><b>Описание параметров командной строки системы.</b></p>
 <p>Используемая в качестве отдельной утилиты система обрабатывает следующие параметры командной строки:
 <ul>
  <li>-fleetPath [path]          путь к БД Флот (сетевой или локальный). Формат базы - DBF. Указывается путь именно к
                                 каталогу, в котором лежат файлы *.dbf. Пробелы в пути лучше не использовать (не тестировалось),
                                 UNC-пути зверек хавает нормально (без пробелов).
  <li>-firmPath [path]           путь к БД Фирм (с етевой или локальный). Формат базы - DBF. Указывается путь именно к
                                 каталогу, в котором лежат файлы *.dbf. Пробелы в пути лучше не использовать (не тестировалось),
                                 UNC-пути зверек хавает нормально (без пробелов).
  <li>-mailHost [host]           хост почтового сервера, используемого для отправки писем (протокол SMTP). Авторизация не
                                 используется. Если же сервер использует авторизацию SMTP, то отправка не получится!
  <li>-mailPort [port]           порт почтового сервера, используемого для отправки писем (протокол SMTP). Если порт не указан
                                 или указан неверно, то будет использован порт по умолчанию (25).
  <li>-mailFrom [from]           обратный адрес, указываемый системой для каждого отправляемого письма.
  <li>-deliveryId [ID]           идентификатор рассылки из БД рассылок на СУБД MS SQL 2005.
  <li>-deliveriesFiles [path]    путь (на локальном диске) к файлам, прикрепленным к рассылке (см. выше описание особенностей
                                 системы, №1 - это часть пути [путь к общему каталогу с файлами]).
  <li>-help                      опция без параметра. Показывается экран с описанием параметров командной строки.
                                 Рассылка не выполняется.
  <li>-demo                      опция без параметра. Включение демо-режима. При этом выполняются все действия (построение
                                 списка мыл, "отправка" писем, добавление инфы в базу рассылок, но физически почта НЕ отправляется.
                                 Режим рекомендуется для отладки и тестирования приложения.
  <li>-version                   опция без параметра. Система просто покажет свою версию. И все. :)
  <li>-testMailTo [email(s)]     электронный адрес (один или несколько), на который (-ые) будет осуществлена рассылка. Другие
                                 адреса будут проигнорированы. Если необходимо указать несколько адресов, то их все следует
                                 заключить в двойные кавычки, а внутри кавычек адреса разделять символами , (запятая) или
                                 ; (точка-с-запятой). Если данный ключ будет указан без указания адреса (-ов), то будет
                                 использован стандартный источник списка е-майл адресов - БД Флот и БД Фирм. Если же и этот источник
                                 будет пуст, то рассылка вообще выполнена не будет.
  <li>-encoding [email_encoding] кодировка электронного письма. Применяется для полей ТЕМА (subject) и ТЕКСТ (text). Если опция
                                 не указана, то будет использована кодировка по умолчанию - windows-1251. Рекомендация: для писем с
                                 русскоязычным содержанием указывать кодировку windows-1251 (не менять значение по умолчанию), а для
                                 писем на английском языке указывать кодировку iso-8859-5.
 </ul>

<p><b>АВТОР:</b>  ГУСЕВ ДМИТРИЙ.<br>
<b>ВЕРСИЯ:</b>    3.2.1 (04.04.2011)

<p>ИСТОРИЯ ВЕРСИЙ.

<br><br><b>1.0.0 (30.08.2010)</b>
   &nbsp;&nbsp;&nbsp;- начальная версия системы.

<br><br><b>2.0.0 (09.12.2010)</b>
   <br>&nbsp;&nbsp;&nbsp;- добавлена обработка параметра командной строки -testMailTo (см. документацию выше).
   <br>&nbsp;&nbsp;&nbsp;- добавлен новый конструктор в модуль DeliveriesDAO.
   <br>&nbsp;&nbsp;&nbsp;- доработана (изменена) структура БД рассылок (см. sql-скрипт), соответственно изменены сигнатуры
   следующих методов модуля DeliveriesDAO: findAll(), setStatusAndError(). См. документацию модуля.
   <br>&nbsp;&nbsp;&nbsp;- улучшена система журналирования всех модулей.
   <br>&nbsp;&nbsp;&nbsp;- изменена используемая системой БД - см. измененный скрипт для создания БД.
   <br>&nbsp;&nbsp;&nbsp;- исправлены несколько уязвимостей модуля Mailer.
   <br>&nbsp;&nbsp;&nbsp;- созданы классы-перечисления (enum) DeliveryStatus и DeliveryType. Описание см.  в модуле констант (Defaults).

<br><br><b>2.0.1 (09.12.2010)</b>
   <br>&nbsp;&nbsp;&nbsp;- в классе-перечислении DeliveryStatus и DeliveryType изменены наименования (сигнатуры) методов доступа
   к значениям элементов перечислений.

<br><br><b>3.0.0 (17.12.2010)</b>
   <br>&nbsp;&nbsp;&nbsp;- создан еще один класс-перечисление (enum) RecipientType - тип получателей(адресатов) данной рассылки. У одной
   рассылки может быть несколько (больше одного, но не менее одного) получателей (адресатов).
   <br>&nbsp;&nbsp;&nbsp;- добавлен параметр командной строки -encoding (см. доку выше).
   <br>&nbsp;&nbsp;&nbsp;- изменена структура БД рассылок (см. sql-скрипт создания БД системы), соответственно изменены/доработаны
   модули DeliveryDTO, DeliveriesDAO. Метод поиска всех рассылок сортирует результат по значению поля timestamp, по убыванию значений
   (самые всежие записи по времени идут вначале списка). Подробнее - см. документацию к указанным модулям.
   <br>&nbsp;&nbsp;&nbsp;- из модуля DeliveryFileDTO убраны лишние (никем не используемые) конструкторы. См. доку к указанному классу.
   <br>&nbsp;&nbsp;&nbsp;- добавлен модуль RecipientTypeDTO. См. javadoc проекта.
   <br>&nbsp;&nbsp;&nbsp;- модуль DbfEmailsListBuilder перемещен во внутренний пакет spammer.mailsList.impl.dbf, также данный модуль
   более не реализует интерфейс EmailsListInterface. В пакете spammer.mailsList.impl.dbf созданы две новые раелизации указанного интерфейса -
   DbfShipownersRus и DbfShipownersEng. Подробнее - см. документацию.
   <br>&nbsp;&nbsp;&nbsp;- удалена опция командной строки -useFleetBase. Выбор источника мейл-адресов осуществляется по данным в БД.

<br><br><b>3.0.1 (20.12.2010)</b>
   <br>&nbsp;&nbsp;&nbsp;- исправлена ошибка в методе findByIntValue() класса-перечисления RecipientType: метод возвращал значение
   типа NULL, при целочисленном значении типа = 1 (правильное значение = RECIPIENT_TYPE_TEST).
   <br>&nbsp;&nbsp;&nbsp;- в модуле Mailer добавлен вывод сообщения об ошибке, если у экземпляра класса рассылки (DeliveryDTO) список
   типов получателей пуст.

<br><br><b>3.0.2 (20.12.2010)</b>
   <br>&nbsp;&nbsp;&nbsp;- исправлена ошибка сортировки в методе findAll(DeliveryType type) модуля DeliveriesDAO: при указанном типе
   рассылки сортировка (order by) добавлялась ПОСЛЕ выражения where запроса, что приводило к ошибочному sql-запросу и возвращению
   методом значения NULL.

<br><br><b>3.0.3 (21.12.2010)</b>
   <br>&nbsp;&nbsp;&nbsp;- исправлена система журналирования модуля DeliveriesDAO - изменен статус одного из сообщений с ERROR на DEBUG.
   <br>&nbsp;&nbsp;&nbsp;- модуль Mailer: статус рассылки "в процессе" (DELIVERY_STATUS_IN_PROCESS) устанавливается сразу же при запуске
   модуля, а не в момент отправки почты (т.к. вспомогательные действия могут занимать много времени, а статус рассылки "завершена"). Этот
   статус (DELIVERY_STATUS_IN_PROCESS) также сразу же пробивается в БД.

<br><br><b>3.0.4 (21.12.2010)</b>
   <br>&nbsp;&nbsp;&nbsp;- изменена сигнатура метода setStatusAndError() модуля DeliveriesDAO. См. javadoc указанного модуля.

<br><br><b>3.1.0 (22.12.2010)</b>
   <br>&nbsp;&nbsp;&nbsp;- перед отправкой каждого письма в модуле Mailer происходит обработка адреса: все "запрещенные" разделители
   адресов заменяются на "разрешенный" (запятая). Это сделано ввиду того, что в одной строке может содержаться несколько адресов для
   отправки, а если они разделены "запрещенным" разделителем (например точка-с-запятой), то отправка не получается (модуль javamail
   возвращает ошибку).
   <br>&nbsp;&nbsp;&nbsp;- исправлена система журналирования модуля (добавлены отладочные сообщения).

<br><br><b>3.2.1 (04.04.2011)</b>
   <br>&nbsp;&nbsp;&nbsp;- добавлена новая таблица (mandatoryEmails) и новое свойство системы - добавление к любой (кроме тестовой)
   рассылке майл-адресов из указанной таблицы. Также добавлен модуль MandatoryEmailsDAO для работы с данной таблицей. Подробнее -
   см. раздел "Особенности системы" выше в данной доке.
   <br>&nbsp;&nbsp;&nbsp;- исправлена ошибка формирования конечного списка e-mail адресов для отправки.

</body>
</html>